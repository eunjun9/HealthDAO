<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
<title></title>
<!-- ë©”íƒ€íƒœê·¸, ìŠ¤íƒ€ì¼ -->
<th:block th:replace="common/head.html"></th:block>
<!--// ë©”íƒ€íƒœê·¸, ìŠ¤íƒ€ì¼ -->
<body>

	<div id="wrap" class="main">
		<!-- HEADER + GNB -->
		<th:block th:replace="common/header.html"></th:block>
		<!--// HEADER + GNB -->
	
		<!-- container -->		
		<div id="container" class="pdt0">
			<div class="site_location">
				<span><a href="/">HOME</a></span>
				<span><a href="/">ë§ˆì´í˜ì´ì§€</a></span>
				<em>ë©”ì¸ ë¡¤ë§ ê´€ë¦¬</em>
			</div>
			<div class="mypage">
				<div class="myWish myCon">
					<div class="contents">
						<th:block th:replace="common/mypageGnb.html"></th:block>
						<!-- myPageCon -->
						<div class="myPageCon">
							<p class="tit mgb40">
								ë§¤ì¸ ë¡¤ë§ ê´€ë¦¬
							</p>
							<div class="pdtWishBar mgb40">
								<span class="inp_check allChk">
									<input type="checkbox" name="inp_check1" id="inp_check1">
									<label for="inp_check1">ì „ì²´ì„ íƒ</label>
								</span>
								<div class="btn_wrap">
									<a href="javascript:void(0)" onclick="showLayer('enrollMain');" class="basketBtn btn btnSizeS btnColorW btnTypeB"><span>ë“±ë¡í•˜ê¸°</span></a>
									<a href="javascript:void(0)" onclick="showLayer('mainDel');" class="wishBtn btn btnSizeS btnColorW btnTypeB"><span>ì‚­ì œí•˜ê¸°</span></a>
								</div>
							</div>
							<div class="tblType1">
								<table summary="ë§¤ì¸ ë¡¤ë§ ê´€ë¦¬ í…Œì´ë¸”">
									<caption>ë§¤ì¸ ë¡¤ë§ ê´€ë¦¬ í…Œì´ë¸”</caption>
									<colgroup>
										<col width="6%">
										<col width="8%">
										<col width="*">
										<col width="12%">
										<col width="30%">
										<col width="6%">
										<col width="8%">
									</colgroup>
									<thead>
										<tr>
											<th>ì„ íƒ</th>
											<th>NO</th>
											<th>ë°°ë„ˆëª…</th>
											<th>ì´ë¯¸ì§€</th>
											<th>URL</th>
											<th>ìˆœìœ„</th>
											<th>ë…¸ì¶œìƒíƒœ</th>
										</tr>
									</thead>
									<tbody th:if="${listCount == 0 }">
										<tr>
											<td colspan="7" class="noData">
												<span>ë“±ë¡ëœ ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.<br>ì§€ê¸ˆ ë°”ë¡œ ë“±ë¡ í•´ë³´ì„¸ìš”.</span>
											</td>
										</tr>
									</tbody>
									<tbody th:unless="${listCount == 0 }">
										<tr th:each="banner : ${bannerList}">
											<td>
												<span class="inp_check">
													<input type="checkbox" name="inp_check1" th:id="@{inp_check1_}+${banner.main_no}" th:value="${banner.main_no}">
													<label th:for="@{inp_check1_}+${banner.main_no}"></label>
													<input type="hidden" name="f_no" th:id="@{inp_check1_}+${banner.main_no}" th:value="${banner.f_no}">
												</span>
											</td>
											<td th:text="${banner.main_no}"></td>
											<td class="tdName" th:value="${banner.main_no}"><a href="javascript:void(0);" th:onclick="|showLayer('modifyMain');selectBanner('${banner.main_no}');|"><span th:text="${banner.main_name}"></span></a></td>
											<td class="tdImg"><img th:src="${banner.file_path}+${banner.change_file}" /></td>
											<td th:text="${banner.main_url}"></td>
											<td th:text="${banner.main_rank}"></td>
											<td th:text="${banner.main_status}"></td>
										</tr>
									</tbody>
								</table>
							</div>
							<div class="paging mgt50" th:unless="${listCount == 0 }" th:with="prev=${pi.page - 1}, next=${pi.page + 1}">
							    <a th:href="@{/banner(page=1)}" class="first"><span class="hide">ì²«í˜ì´ì§€</span></a>
							    <a class="prev" href="/banner?page=" th:attrappend="href=${prev}"><span class="hide">ì´ì „í˜ì´ì§€</span></a>
							    <a th:each="page : ${#numbers.sequence(pi.startPage, pi.endPage)}" href="/banner?page=" th:attrappend="href=${page}" th:text="${page}" th:classappend="${page} == ${#httpServletRequest.getParameter('page')} ? active"></a>	                                   
							    <a class="next" href="/banner?page=" th:attrappend="href=${next}"><span class="hide">ë‹¤ìŒí˜ì´ì§€</span></a>
							    <a href="/banner?page=" th:attrappend="href=${pi.maxPage}" class="last"><span class="hide">ë§ˆì§€ë§‰í˜ì´ì§€</span></a>
							</div>
						</div>
						<!-- //myPageCon -->
					</div>
				</div>
			</div>
		</div>
		<!-- //container -->
		
		<!-- ìŠ¤í¬ë¦½íŠ¸ -->
		<th:block th:replace="common/script.html"></th:block>
		<!--// ìŠ¤í¬ë¦½íŠ¸ -->
		<!-- FOOTER -->
		<th:block th:replace="common/footer.html"></th:block>
		<!--// FOOTER -->
	</div>
	
	<!-- í€µë©”ë‰´ + í†¡í†¡ -->
	<th:block th:replace="common/quickNtalk.html"></th:block>
	<!--// í€µë©”ë‰´ + í†¡í†¡ -->	
	<!-- í•´ë‹¹ í˜ì´ì§€ì—ì„œë§Œ ì‚¬ìš©ë˜ëŠ” ìŠ¤íƒ€ì¼, ìŠ¤í¬ë¦½íŠ¸ -->
	<script type="text/javascript">
		$('#quick .quickArea').css({'position':'absolute', 'top':290});

	    function submit(){
	    	if($('#enrollMain input[name="main_name"]').val() == ''){
	       		alert('ë°°ë„ˆëª…ì„ ë„£ì–´ì£¼ì„¸ìš”');
	       		return false;	    		
	    	}
	    	if($('#enrollMain input[name="main_url"]').val() == ''){
	       		alert('urlì„ ë„£ì–´ì£¼ì„¸ìš”');
	       		return false;	    		
	    	}
	    	if($('#enrollMain input[name="imgUpload1"]').val() == ''){
	       		alert('ì´ë¯¸ì§€ëŠ” ê¼­ ë„£ì–´ì•¼ ë©ë‹ˆë‹¤ğŸ˜µ');
	       		return false;
	    	}
	    	if($('#enrollMain input[name="main_rank"]').val() == ''){
	       		alert('ìˆœìœ„ë¥¼ ë„£ì–´ì•¼ ë©ë‹ˆë‹¤');
	       		return false;
	    	}
	       	document.enroll.submit();
	    }
	    
	    function update(){
	    	if($('#modifyMain input[name="name"]').val() == ''){
	       		alert('ë°°ë„ˆëª…ì„ ë„£ì–´ì£¼ì„¸ìš”');
	       		return false;	    		
	    	}
	    	if($('#modifyMain input[name="url"]').val() == ''){
	       		alert('urlì„ ë„£ì–´ì£¼ì„¸ìš”');
	       		return false;	    		
	    	}
	    	if($('#modifyMain input[name="rank"]').val() == ''){
	       		alert('ìˆœìœ„ë¥¼ ë„£ì–´ì•¼ ë©ë‹ˆë‹¤');
	       		return false;
	    	}
	       	document.updated.submit();
	    }
	    $(function(){
			// ì´ë¯¸ì§€ ì¶”ê°€
			$('.imgUpload').on('change', function(){
		       const target = $(this);
		       var uploadFiles = target[0].files;
		       if(uploadFiles.length > 1){
					alert('ì´ë¯¸ì§€ëŠ” ìµœëŒ€ 1ê°œê¹Œì§€ ì²¨ë¶€ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
					return;
		       	}
		       
		       var htmlList = '';
		       $.each(uploadFiles, function(index, file){
		       	var reader = new FileReader();
				reader.onload = function(e) {
					htmlList += '<li class="imgCutting">';
					htmlList += '	<div class="imgBox">';
					htmlList += '		<img src="'+e.target.result+'" alt="">';
					htmlList += '	</div>';
					htmlList += '	<a href="javascript:void(0)" onclick="removeImg(this);" class="closeLink"><span class="hide">close</span></a>';
					htmlList += '</li>';
			        $('.fileUploadArea').append(htmlList);
			        htmlList = '';
					imgCrop();
				}
				reader.readAsDataURL(file);
		       });
			});
		});
		// ì´ë¯¸ì§€ ì‚­ì œ
		function removeImg(e){
			var idx = $('.fileUploadArea li.imgCutting').index($(e).closest('li.imgCutting'));
			$(e).closest('li.imgCutting').remove();
			$(e).closest('.imgUpload').val('');
		}
	</script>
	<!--// í•´ë‹¹ í˜ì´ì§€ì—ì„œë§Œ ì‚¬ìš©ë˜ëŠ” ìŠ¤íƒ€ì¼, ìŠ¤í¬ë¦½íŠ¸ -->
	<!-- ë©”ì¸ë¡¤ë§ ë“±ë¡ -->
	<div id="enrollMain" class="lyPopArea bannerPop">
	    <div class="lyPop">
	        <div class="lyWrap">
	            <button type="button" class="lyClose" onclick="layerPopClose();"><span class="hide">CLOSED</span></button>
	            <div class="lyTit">ë©”ì¸ ë¡¤ë§ ë“±ë¡</div>
	            <form action="banner/upload" name="enroll" method="post" enctype="multipart/form-data">
		            <div class="lyBody">			
						<ul class="inputArea">
							<li>
								<dl>
									<dt>ë°°ë„ˆëª…</dt>
									<dd>
										<div class="inp_wrap">
											<div class="inp_text sizeS">
												<input type="text" name="main_name" id="name" placeholder="ë©”ì¸ ë¡¤ë§ ë°°ë„ˆ ë‡½ë‡½ğŸ„ğŸ„">
												<button class="btn_clear" type="button"><span>clear</span></button>
											</div>
										</div>
									</dd>
								</dl>
								<dl class="mgt20">
									<dt>URL</dt>
									<dd>
										<div class="inp_wrap">
											<div class="inp_text sizeS">
												<input type="text" name="main_url" id="url" placeholder="/event?no=1">
												<button class="btn_clear" type="button"><span>clear</span></button>
											</div>
										</div>
									</dd>
								</dl>
								<dl class="mgt15">
									<dt>ì‚¬ì§„ ì¶”ê°€</dt>
									<dd>
										<ul class="fileUploadArea">
											<li>
												<label for="imgUpload1"><span class="hide">ì—…ë¡œë“œ</span>
												</label><input type="file" class="hide imgUpload" name="imgUpload1" id="imgUpload1" accept="image/*">												
											</li>
										</ul>
										<p class="mgt5 fs14">íŒŒì¼ì²¨ë¶€ (1ê°œ) <span class="fc88">5MBë¯¸ë§Œ jpg,gif,png íŒŒì¼ ê°€ëŠ¥</span></p>
									</dd>
								</dl>
							</li>
							<li>
								<dl class="mgt20">
									<dt>ìˆœìœ„</dt>
									<dd>
										<div class="inp_wrap">
											<div class="inp_text sizeS">
												<input type="text" name="main_rank" id="rank" placeholder="1">
												<button class="btn_clear" type="button"><span>clear</span></button>
											</div>
										</div>
									</dd>
								</dl>
								<dl class="mgt20">
									<dt>ë…¸ì¶œìƒíƒœ</dt>
									<dd class="mgt7">
										<div class="inp_wrap">
											<span class="inp_radio">
												<input type="radio" name="main_status" id="bannerStatus1_1" value="Y" checked>
												<label for="bannerStatus1_1">ë…¸ì¶œ</label>
											</span>
											<span class="inp_radio mgl40">
												<input type="radio" name="main_status" id="bannerStatus1_2" value="N">
												<label for="bannerStatus1_2">ë¹„ë…¸ì¶œ</label>
											</span>
										</div>
										<p class="fs13 fc88 mgt10">* ë…¸ì¶œë¡œ ë“±ë¡ì‹œ ë©”ì¸í™”ë©´ì— ë“±ë¡ë©ë‹ˆë‹¤.</p>
									</dd>
								</dl>
							</li>
						</ul>
						<div class="btn_wrap mgt30">
							<a href="javascript:void(0);" class="btn btnSizeL btnArr btnColorW btnTypeR" style="width:200px;" onclick="layerPopClose();"><span>ì·¨ì†Œ</span></a>
							<a href="javascript:void(0);" class="btn btnSizeL btnArr btnColorB btnTypeR" style="width:200px;" onclick="return submit();"><span>ë“±ë¡</span></a>
						</div>
				     </div>
				</form>
	        </div>
	    </div>
	</div>
	<!-- ë©”ì¸ë¡¤ë§ ìˆ˜ì • -->
	<div id="modifyMain" class="lyPopArea bannerPop">
	    <div class="lyPop">
	        <div class="lyWrap">
	            <button type="button" class="lyClose" onclick="layerPopClose();"><span class="hide">CLOSED</span></button>
	            <div class="lyTit">ë©”ì¸ ë¡¤ë§ ìˆ˜ì •</div>
	            <form action="banner/update" name="updated" method="post" enctype="multipart/form-data">
		            <div class="lyBody">			
						<ul class="inputArea">
							<li>
								<dl>
									<dt>ë°°ë„ˆëª…</dt>
									<dd>
										<div class="inp_wrap">
											<div class="inp_text sizeS">
												<input type="hidden" name="main_no" id="no" value="">
												<input type="text" name="main_name" id="name" value="ë©”ì¸ ë¡¤ë§ ë°°ë„ˆ ë‡½ë‡½ğŸ„ğŸ„">
												<button class="btn_clear" type="button"><span>clear</span></button>
												<input type="hidden" name="f_no" id="f_no" value="">
											</div>
										</div>
									</dd>
								</dl>
								<dl class="mgt20">
									<dt>URL</dt>
									<dd>
										<div class="inp_wrap">
											<div class="inp_text sizeS">
												<input type="text" name="main_url" id="url" value="/event?no=1">
												<button class="btn_clear" type="button"><span>clear</span></button>
											</div>
										</div>
									</dd>
								</dl>
								<dl class="mgt15">
									<dt>ì‚¬ì§„ ì¶”ê°€</dt>
									<dd>
										<ul class="fileUploadArea">
											<li>
												<label for="imgUpload"><span class="hide">ì—…ë¡œë“œ</span></label>
												<input type="file" class="hide imgUpload" name="imgUpload" id="imgUpload">
											</li>
											<li class="imgCutting">
												<div class="imgBox">
													<img id="img" src="./resources/web/images/temp/main01.jpg" alt="">
												</div>
												<a href="javascript:void(0)" onclick="removeImg(this);" class="closeLink"><span class="hide">close</span></a>
											</li>
										</ul>
										<p class="mgt5 fs14">íŒŒì¼ì²¨ë¶€ (1ê°œ) <span class="fc88">5MBë¯¸ë§Œ jpg,gif,png íŒŒì¼ ê°€ëŠ¥</span></p>
									</dd>
								</dl>
							</li>
							<li>
								<dl class="mgt20">
									<dt>ìˆœìœ„</dt>
									<dd>
										<div class="inp_wrap">
											<div class="inp_text sizeS">
												<input type="text" name="main_rank" id="rank" value="1">
												<button class="btn_clear" type="button"><span>clear</span></button>
											</div>
										</div>
									</dd>
								</dl>
								<dl class="mgt20">
									<dt>ë…¸ì¶œìƒíƒœ</dt>
									<dd class="mgt7">
										<div id="modifyStatus" class="inp_wrap">
											<span class="inp_radio">
												<input type="radio" name="main_status" id="bannerStatus1" value="Y" checked>
												<label for="bannerStatus1">ë…¸ì¶œ</label>
											</span>
											<span class="inp_radio mgl40">
												<input type="radio" name="main_status" id="bannerStatus2" value="N">
												<label for="bannerStatus2">ë¹„ë…¸ì¶œ</label>
											</span>
										</div>
										<p class="fs13 fc88 mgt10">* ë…¸ì¶œë¡œ ë“±ë¡ì‹œ ë©”ì¸í™”ë©´ì— ë“±ë¡ë©ë‹ˆë‹¤.</p>
									</dd>
								</dl>
							</li>
						</ul>
						<div class="btn_wrap mgt30">
							<a href="javascript:void(0);" class="btn btnSizeL btnArr btnColorW btnTypeR" style="width:200px;" onclick="layerPopClose();"><span>ì·¨ì†Œ</span></a>
							<a href="javascript:void(0);" class="btn btnSizeL btnArr btnColorB btnTypeR" style="width:200px;" onclick="return update();"><span>ìˆ˜ì •</span></a>
						</div>
	            	</div>
	            </form>
	        </div>
	    </div>
	</div>
	<!-- ë©”ì¸ë¡¤ë§ ì‚­ì œ -->
	<div id="mainDel" class="lyPopArea bannerPop">
	    <div class="lyPop">
	        <div class="lyWrap">
	            <button type="button" class="lyClose" onclick="layerPopClose();"><span class="hide">CLOSED</span></button>
	            <div class="lyTit">ë©”ì¸ ë¡¤ë§ ì‚­ì œ</div>
	            <div class="lyBody basic">
	                <p>ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
	                <div class="btn_wrap length2">
	                    <a href="javascript:void(0);" onclick="layerPopClose();" class="btn btnSizeL btnArr btnColorW btnTypeR"><span>ì·¨ì†Œ</span></a>
	                    <a href="javascript:void(0);" onclick="deleteBanner();" class="btn btnSizeL btnArr btnColorB btnTypeR"><span>í™•ì¸</span></a>
	                </div>
	            </div>
	        </div>
	    </div>
	</div>
	<script>
		function selectBanner(e){
			console.log(e);
			var result = e;
			var sendData = {"main_no":result};
			$.ajax({
				url: "/banner/select",
				method: 'POST',
				data: sendData,
				success: function(data){
					console.log(data);
					$("#modifyMain #no").val(data.main_no);
					$("#modifyMain #name").val(data.main_name);
					$("#modifyMain #f_no").val(data.f_no);
					$("#modifyMain #url").val(data.main_url);
					$("#modifyMain #img").attr('src', data.file_path + data.change_file);
					$("#modifyMain #rank").val(data.main_rank);				

					//ìƒíƒœ
					let stateHtml = "";					
					if(data.main_status == "Y"){
						stateHtml = '<span class="inp_radio">'
								  + '<input type="radio" name="main_status" id="bannerStatus1" value="Y" checked><label for="bannerStatus1">ë…¸ì¶œ</label></span>'
								  + '<span class="inp_radio mgl40">'
								  + '<input type="radio" name="main_status" id="bannerStatus2" value="N"><label for="bannerStatus2">ë¹„ë…¸ì¶œ</label></span>';
					}else{
						stateHtml = '<span class="inp_radio">'
								  + '<input type="radio" name="main_status" id="bannerStatus1" value="Y" ><label for="bannerStatus1">ë…¸ì¶œ</label></span>'
								  + '<span class="inp_radio mgl40">'
								  + '<input type="radio" name="main_status" id="bannerStatus2" value="N" checked><label for="bannerStatus2">ë¹„ë…¸ì¶œ</label></span>';
					}					
					document.getElementById("modifyStatus").innerHTML = stateHtml;					
				},
				error: function(e){
					console.log(e);
				}
			});
		}
		
		function deleteBanner(){
			let addList = [], addList2 = [], data = {};
			let chk = $('.checked:not(.allChk) input[name="inp_check1"]:checked');		
			let chkLength = chk.length;	// ì²´í¬ëœ ê°¯ìˆ˜
			let chk2 = $('.checked:not(.allChk) input[name="inp_check1"]:checked').siblings('input[name="f_no"]');	
			
			if(chkLength >= 1){
				for(var i = 0; i < chkLength; i++){
					addList[i] = chk[i].value;
					addList2[i] = chk2[i].value;

				    data.addList = addList;		// ì²´í¬ëœ ê°’ ë°°ì—´ì— ë‹´ê¸°
				    data.addList2 = addList2;	// ì²´í¬ëœ ê°’ ë°°ì—´ì— ë‹´ê¸°
				}
				console.log(data);				// ë°°ì—´ì— ë‹´ê¸´ ê°’
				$.ajax({
					url : "/banner/delete",
					dataType : "JSON",
					data : data,
					type : "POST",
					traditional : true,		// ë°°ì—´ë¡œ ê°’ ë„˜ê¸¸ë•Œ í•„ìš”í•œ ì„ ì–¸
					success : function(data){
						console.log(data);
						if(chkLength == data){
							location.reload();
						}else{
							alert('ì‹¤íŒ¨');
						}
					},
					error : function(e){
						console.log(e);
					}
				});
			}else{
				alert('ì„ íƒëœ ê°’ì´ ì—†ìŠµë‹ˆë‹¤.');
			}
		}

		$(document).on('click', '.inp_check label', function (){
			if ($(this).parent().hasClass('readOnly')){return false;}
			if ($(this).parent().hasClass('disabled')){return false;}
			
			var tar = $(this).parent().find('input');
			var chk = tar.prop('checked');
			var grpNm = tar.attr('name');


			if ($(this).parent('.inp_check').hasClass('allChk')){
				var chkStatus = tar.prop('checked');
				$("input:checkbox[name=" + grpNm + "]").each(function() {
					if (chkStatus) {
						$(this).closest(".inp_check").removeClass("checked");
						$(this).prop("checked",false);
					} else {
						$(this).closest(".inp_check").addClass("checked");
						$(this).prop("checked",true);
					}
				});
			} else {
				if ($(this).parent().hasClass('checked')) {
					$("input:checkbox[name=" + grpNm + "]").each(function() {
						$(this).closest('.inp_check.allChk').removeClass('checked');;
						$(this).closest('.inp_check.allChk input').prop("checked",false);
					});
					$(this).parent().removeClass('checked');				
					if($(this).attr('for') == 'remember'){
						deleteCookie("rememberId");
					}
					tar.prop("checked",false);
				} else {
					$(this).parent().addClass('checked');				
					if($(this).attr('for') == 'remember'){
						setCookie("rememberId", userId.value, 7);
					}
					tar.prop("checked",true);
				}
			}
			console.log(tar.prop('checked'));
			return false;
		});
	</script>
</body>
</html>
